<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lombard TS Verifier - Test</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family:
        -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto,
        Oxygen, Ubuntu, Cantarell, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      overflow: hidden;
    }

    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .header h1 {
      font-size: 2em;
      margin-bottom: 10px;
    }

    .header p {
      opacity: 0.9;
      font-size: 1.1em;
    }

    .content {
      padding: 30px;
    }

    .test-section {
      background: #f8f9fa;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
    }

    .test-section h2 {
      color: #667eea;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .status {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.85em;
      font-weight: 600;
    }

    .status.pending {
      background: #ffc107;
      color: #000;
    }

    .status.success {
      background: #28a745;
      color: white;
    }

    .status.error {
      background: #dc3545;
      color: white;
    }

    .input-group {
      margin-bottom: 15px;
    }

    .input-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 600;
      color: #333;
    }

    .input-group select,
    .input-group input {
      width: 100%;
      padding: 10px;
      border: 2px solid #e0e0e0;
      border-radius: 6px;
      font-size: 1em;
      transition: border-color 0.3s;
    }

    .input-group select:focus,
    .input-group input:focus {
      outline: none;
      border-color: #667eea;
    }

    .btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 12px 30px;
      border-radius: 6px;
      font-size: 1em;
      font-weight: 600;
      cursor: pointer;
      transition:
        transform 0.2s,
        box-shadow 0.2s;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
    }

    .btn:active {
      transform: translateY(0);
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .result {
      background: white;
      border: 2px solid #e0e0e0;
      border-radius: 6px;
      padding: 15px;
      margin-top: 15px;
      font-family: 'Courier New', monospace;
      font-size: 0.9em;
      white-space: pre-wrap;
      word-break: break-all;
      max-height: 400px;
      overflow-y: auto;
    }

    .result.success {
      border-color: #28a745;
      background: #f0fff4;
    }

    .result.error {
      border-color: #dc3545;
      background: #fff5f5;
      color: #dc3545;
    }

    .log {
      background: #1e1e1e;
      color: #d4d4d4;
      border-radius: 6px;
      padding: 15px;
      margin-top: 15px;
      font-family: 'Courier New', monospace;
      font-size: 0.85em;
      max-height: 300px;
      overflow-y: auto;
    }

    .log-entry {
      margin-bottom: 5px;
    }

    .log-entry.info {
      color: #4ec9b0;
    }

    .log-entry.error {
      color: #f48771;
    }

    .log-entry.success {
      color: #b5cea8;
    }

    .examples {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }

    .example-card {
      background: white;
      border: 2px solid #e0e0e0;
      border-radius: 6px;
      padding: 12px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .example-card:hover {
      border-color: #667eea;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .example-card h4 {
      color: #667eea;
      margin-bottom: 8px;
    }

    .example-card p {
      font-size: 0.85em;
      color: #666;
      word-break: break-all;
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <h1>üîê Lombard TS Verifier</h1>
      <p>Bitcoin Address Generation Testing</p>
    </div>

    <div class="content">
      <!-- Module loading status -->
      <div class="test-section">
        <h2>
          üì¶ Module Status:
          <span id="module-status" class="status pending">Loading...</span>
        </h2>
        <div id="module-info" class="log"></div>
      </div>

      <!-- Testing form -->
      <div class="test-section">
        <h2>üß™ Address Testing</h2>

        <div class="input-group">
          <label for="chain-select">Blockchain:</label>
          <select id="chain-select">
            <option value="Ethereum">Ethereum</option>
            <option value="BSC">
              BSC (Binance Smart Chain)
            </option>
            <option value="Base">Base</option>
            <option value="Arbitrum">Arbitrum</option>
            <option value="Optimism">Optimism</option>
            <option value="Polygon">Polygon</option>
            <option value="Avalanche">Avalanche</option>
            <option value="Sui">Sui</option>
            <option value="Solana">Solana</option>
          </select>
        </div>

        <div class="input-group">
          <label for="address-input">Destination Address:</label>
          <input type="text" id="address-input" placeholder="0x57f9672ba603251c9c03b36cabdbbca7ca8cfcf4" />
        </div>

        <div class="input-group">
          <label for="network-select">Bitcoin Network:</label>
          <select id="network-select">
            <option value="mainnet">Mainnet</option>
            <option value="testnet">Testnet</option>
          </select>
        </div>

        <button id="test-btn" class="btn" disabled>
          Generate Address
        </button>

        <div id="test-result"></div>
      </div>

      <!-- Examples -->
      <div class="test-section">
        <h2>üìã Address Examples</h2>
        <p style="margin-bottom: 15px; color: #666">
          Click on a card to test:
        </p>

        <div class="examples">
          <div class="example-card" data-chain="Ethereum" data-address="0x57f9672ba603251c9c03b36cabdbbca7ca8cfcf4">
            <h4>Ethereum</h4>
            <p>0x57f9...cfcf4</p>
          </div>
          <div class="example-card" data-chain="BSC" data-address="0xf594c30b28435afb37f0b10f71ac9fe45389fbdc">
            <h4>BSC</h4>
            <p>0xf594...fbdc</p>
          </div>
          <div class="example-card" data-chain="Base" data-address="0x0f90793a54e809bf708bd0fbcc63d311e3bb1be1">
            <h4>Base</h4>
            <p>0x0f90...1be1</p>
          </div>
          <div class="example-card" data-chain="Sui"
            data-address="0xa51d5c52371626bb6894ce9b599c935f8dea92ca34668f2da7148df2458640b8">
            <h4>Sui</h4>
            <p>0xa51d...40b8</p>
          </div>
        </div>
      </div>

      <!-- Console log -->
      <div class="test-section">
        <h2>üìù Console</h2>
        <div id="console-log" class="log">
          <div class="log-entry info">
            Waiting for module to load...
          </div>
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    // Intercept console.log
    const consoleLog = document.getElementById('console-log');
    const originalLog = console.log;
    const originalError = console.error;

    function addLogEntry(message, type = 'info') {
      const entry = document.createElement('div');
      entry.className = `log-entry ${type}`;
      entry.textContent =
        typeof message === 'object'
          ? JSON.stringify(message, null, 2)
          : message;
      consoleLog.appendChild(entry);
      consoleLog.scrollTop = consoleLog.scrollHeight;
    }

    console.log = (...args) => {
      originalLog(...args);
      const message = args
        .map((arg) =>
          typeof arg === 'object'
            ? JSON.stringify(arg, null, 2)
            : String(arg)
        )
        .join(' ');
      addLogEntry(message, 'info');
    };

    console.error = (...args) => {
      originalError(...args);
      const message = args
        .map((arg) =>
          typeof arg === 'object'
            ? JSON.stringify(arg, null, 2)
            : String(arg)
        )
        .join(' ');
      addLogEntry(message, 'error');
    };

    // Load module
    let tsVerifier;
    const moduleStatus = document.getElementById('module-status');
    const moduleInfo = document.getElementById('module-info');
    const testBtn = document.getElementById('test-btn');

    try {
      console.log(
        'üöÄ Loading module @lombard.finance/ts-verifier...'
      );

      // Import built module
      tsVerifier = await import('./dist/index.js');

      console.log('tsVerifier', tsVerifier);

      moduleStatus.textContent = 'Loaded ‚úì';
      moduleStatus.className = 'status success';

      console.log('‚úÖ Module successfully loaded');
      console.log(
        'üì¶ Exported functions:',
        Object.keys(tsVerifier).join(', ')
      );

      // Show module information
      const info = [
        `Exported functions: ${Object.keys(tsVerifier).length}`,
        `Main functions:`,
        `  - calculateDeterministicAddress`,
        `  - SupportedBlockchains`,
        `  - Networks`,
      ].join('\n');

      addLogEntry(info, 'success');

      testBtn.disabled = false;
    } catch (error) {
      moduleStatus.textContent = 'Loading Error ‚úó';
      moduleStatus.className = 'status error';

      console.error('‚ùå Module loading error:', error.message);
      console.error('Details:', error);

      addLogEntry(`Error: ${error.message}`, 'error');
    }

    // Test handler
    testBtn.addEventListener('click', async () => {
      const chain = document.getElementById('chain-select').value;
      const address = document
        .getElementById('address-input')
        .value.trim();
      const network = document.getElementById('network-select').value;
      const resultDiv = document.getElementById('test-result');

      if (!address) {
        resultDiv.innerHTML =
          '<div class="result error">‚ùå Enter destination address</div>';
        return;
      }

      testBtn.disabled = true;
      resultDiv.innerHTML =
        '<div class="result">‚è≥ Generating address...</div>';

      console.log(`\nüîÑ Starting address generation for ${chain}...`);
      console.log(`Destination address: ${address}`);
      console.log(`Bitcoin network: ${network}`);

      try {
        const chainEnum = tsVerifier.SupportedBlockchains[chain];
        const networkEnum = tsVerifier.Networks[network];

        const startTime = performance.now();
        const result =
          await tsVerifier.calculateDeterministicAddress(
            chainEnum,
            address,
            networkEnum
          );
        const endTime = performance.now();
        const duration = (endTime - startTime).toFixed(2);

        console.log(
          `‚úÖ Address successfully generated in ${duration}ms`
        );
        console.log('Result:', result);

        const resultHTML = `
                    <div class="result success">
                        <strong>‚úÖ Successfully generated!</strong>
                        <br><br>
                        <strong>Bitcoin address:</strong><br>
                        ${result.btcAddress}
                        <br><br>
                        <strong>Blockchain:</strong> ${chain}<br>
                        <strong>Destination address:</strong> ${address}<br>
                        <strong>Network:</strong> ${network}<br>
                        <strong>Execution time:</strong> ${duration}ms
                        <br><br>
                        <strong>Full result:</strong><br>
                        ${JSON.stringify(result, null, 2)}
                    </div>
                `;

        resultDiv.innerHTML = resultHTML;
        addLogEntry(
          `Address generated: ${result.btcAddress}`,
          'success'
        );
      } catch (error) {
        console.error('‚ùå Generation error:', error.message);
        console.error('Details:', error);

        const errorHTML = `
                    <div class="result error">
                        <strong>‚ùå Generation Error</strong>
                        <br><br>
                        <strong>Message:</strong><br>
                        ${error.message}
                        <br><br>
                        <strong>Error type:</strong><br>
                        ${error.constructor.name}
                        <br><br>
                        <strong>Stack trace:</strong><br>
                        ${error.stack || 'Not available'}
                    </div>
                `;

        resultDiv.innerHTML = errorHTML;
        addLogEntry(`Error: ${error.message}`, 'error');
      } finally {
        testBtn.disabled = false;
      }
    });

    // Example handler
    document.querySelectorAll('.example-card').forEach((card) => {
      card.addEventListener('click', () => {
        const chain = card.dataset.chain;
        const address = card.dataset.address;

        document.getElementById('chain-select').value = chain;
        document.getElementById('address-input').value = address;

        console.log(`üìã Example loaded for ${chain}`);

        // Automatically run test
        testBtn.click();
      });
    });
  </script>
</body>

</html>